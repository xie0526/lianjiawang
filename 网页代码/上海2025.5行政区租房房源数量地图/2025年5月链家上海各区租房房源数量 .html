<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>ä¸Šæµ·è¡Œæ”¿åŒºå›¾è¡¨åˆ‡æ¢æ¨¡å—</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  <style>
    .shanghai-chart-module {
      max-width: 900px;
      margin: 20px auto;
      border-radius: 12px;
      overflow: hidden;
      font-family: Arial, sans-serif;
      background-color: #f3e4e4; /* ç”± rgba æ”¹ä¸ºçº¯ç™½ */
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.1);
      position: relative;
      padding: 20px;
      box-sizing: border-box;
    }
    .shanghai-chart-module .title {
      background-color: #f3e4e4; /* ä¿æŒä¸€è‡´ */
      padding: 8px 0;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      color: #333;
      margin-bottom: 12px;
      user-select: none;
      border-radius: 8px 8px 0 0;
    }
    .shanghai-chart-module .toolbar {
      display: flex;
      justify-content: space-between;
      max-width: 300px;
      margin: 0 auto 16px auto;
      align-items: center;
    }
    .shanghai-chart-module .btn {
      padding: 6px 14px;
      font-size: 14px;
      border: none;
      border-radius: 6px;
      background-color: #3f51b5;
      color: #f3e4e4;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .shanghai-chart-module .btn:hover {
      background-color: #5c6bc0;
    }
    .shanghai-chart-module .mode-label {
      font-size: 14px;
      color: #222;
      font-weight: 500;
      white-space: nowrap;
    }
    .shanghai-chart-module #main {
      height: 440px;
      width: 100%;
      background-color: #f3e4e4; /* ä¸å®¹å™¨ä¸€è‡´ */
      border-radius: 0 0 12px 12px;
    }
  </style>
</head>
<body>

  <section class="shanghai-chart-module" aria-label="ä¸Šæµ·è¡Œæ”¿åŒºç§Ÿæˆ¿æ•°æ®å›¾è¡¨æ¨¡å—">
    <div class="title">2025å¹´5æœˆä¸Šæµ·å„è¡Œæ”¿åŒºç§Ÿæˆ¿æˆ¿æºæ•°æ®åˆ†å¸ƒ</div>
    <div class="toolbar">
      <button class="btn" id="toggleBtn">ğŸ“Š åˆ‡æ¢å›¾è¡¨</button>
      <div class="mode-label" id="modeLabel">å½“å‰æ¨¡å¼ï¼šğŸ—ºï¸ åœ°å›¾</div>
    </div>
    <div id="main"></div>
  </section>

  <script>
  (function() {
    const rawData = [
      { name: 'é™å®‰åŒº', value: 3364 },
      { name: 'å¾æ±‡åŒº', value: 3754 },
      { name: 'é»„æµ¦åŒº', value: 1596 },
      { name: 'é•¿å®åŒº', value: 2418 },
      { name: 'æ™®é™€åŒº', value: 3181 },
      { name: 'æµ¦ä¸œæ–°åŒº', value: 13792 },
      { name: 'å®å±±åŒº', value: 4133 },
      { name: 'è™¹å£åŒº', value: 1699 },
      { name: 'æ¨æµ¦åŒº', value: 3067 },
      { name: 'é—µè¡ŒåŒº', value: 6848 },
      { name: 'é‡‘å±±åŒº', value: 478 },
      { name: 'å˜‰å®šåŒº', value: 3896 },
      { name: 'å´‡æ˜åŒº', value: 456 },
      { name: 'å¥‰è´¤åŒº', value: 1171 },
      { name: 'æ¾æ±ŸåŒº', value: 3608 },
      { name: 'é’æµ¦åŒº', value: 2295 }
    ];

    const chartDom = document.querySelector('.shanghai-chart-module #main');
    const chart = echarts.init(chartDom);
    let currentMode = 'map';

    const toggleBtn = document.querySelector('.shanghai-chart-module #toggleBtn');
    const modeLabel = document.querySelector('.shanghai-chart-module #modeLabel');

    function updateModeLabel() {
      modeLabel.innerText = `å½“å‰æ¨¡å¼ï¼š${currentMode === 'map' ? 'ğŸ—ºï¸ åœ°å›¾' : 'ğŸ“Š æŸ±çŠ¶å›¾'}`;
    }

    function renderMap() {
      currentMode = 'map';
      updateModeLabel();
      chart.clear();
      chart.setOption({
        backgroundColor: '#ffffff', // ç»Ÿä¸€ç™½åº•
        tooltip: {
          trigger: 'item',
          formatter: p => `${p.name}<br/>æ•°é‡ï¼š<b>${p.value || 0}</b>`
        },
        visualMap: {
          min: 400,
          max: 14000,
          left: '3%',
          bottom: 20,
          text: ['å¤š', 'å°‘'],
          inRange: {
            color: ['#e0f3f8', '#abd9e9', '#ffffbf', '#fdae61', '#d7191c']
          },
          calculable: true
        },
        series: [{
          id: 'shData',
          type: 'map',
          map: 'shanghai',
          roam: false,
          universalTransition: true,
          label: { show: false },
          emphasis: {
            label: { show: true },
            itemStyle: { areaColor: '#fff59d' }
          },
          itemStyle: { borderColor: '#999' },
          data: rawData
        }]
      });
    }

    function renderBar() {
      currentMode = 'bar';
      updateModeLabel();
      chart.clear();
      const sorted = [...rawData].sort((a, b) => a.value - b.value);
      const maxVal = Math.max(...sorted.map(i => i.value));
      const minVal = Math.min(...sorted.map(i => i.value));

      function getColor(value) {
        const cold = [37, 106, 165];
        const warm = [215, 25, 28];
        const ratio = (value - minVal) / (maxVal - minVal);
        const r = Math.round(cold[0] + ratio * (warm[0] - cold[0]));
        const g = Math.round(cold[1] + ratio * (warm[1] - cold[1]));
        const b = Math.round(cold[2] + ratio * (warm[2] - cold[2]));
        return `rgb(${r},${g},${b})`;
      }

      chart.setOption({
        backgroundColor: '#ffffff', // ç»Ÿä¸€ç™½åº•
        tooltip: {
          trigger: 'axis',
          axisPointer: { type: 'shadow' }
        },
        xAxis: {
          type: 'value',
          name: 'æ•°é‡',
          nameTextStyle: { fontWeight: 'bold' }
        },
        yAxis: {
          type: 'category',
          data: sorted.map(i => i.name),
          axisLabel: {
            rotate: 30,
            color: '#444',
            fontWeight: 'bold'
          }
        },
        series: [{
          id: 'shData',
          type: 'bar',
          universalTransition: true,
          data: sorted.map(i => ({
            value: i.value,
            itemStyle: {
              color: getColor(i.value),
              borderRadius: [4, 4, 0, 0]
            }
          }))
        }]
      });
    }

    function init() {
      fetch('310000_full.json')
        .then(res => res.json())
        .then(geoJson => {
          echarts.registerMap('shanghai', geoJson);
          renderMap();
        });

      toggleBtn.addEventListener('click', () => {
        toggleBtn.innerText = currentMode === 'map' ? 'ğŸ—ºï¸ åˆ‡æ¢åœ°å›¾' : 'ğŸ“Š åˆ‡æ¢å›¾è¡¨';
        currentMode === 'map' ? renderBar() : renderMap();
      });

      window.addEventListener('resize', () => {
        chart.resize();
      });
    }

    init();
  })();
  </script>

</body>
</html>
